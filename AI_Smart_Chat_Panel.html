<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Darkainet bot</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap');

:root {
    --primary-color: #2563eb;
    --primary-dark: #1e40af;
    --bg-color: #f0f4ff;
    --user-bg: #e0f2fe;
    --ai-bg: #fff;
    --text-color: #1f2937;
    --shadow: 0 4px 6px rgba(0,0,0,0.1);
}

*{box-sizing:border-box;margin:0;padding:0;font-family:'Vazirmatn',sans-serif;}

body {background-color: var(--bg-color); display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; padding: 2rem;}

.chat-container {width: 100%; max-width: 600px; background: var(--bg-color); border-radius: 15px; box-shadow: var(--shadow); display: flex; flex-direction: column; overflow: hidden;}

.chat-header {padding: 1rem; background: var(--primary-color); color: white; display: flex; justify-content: space-between; align-items: center; font-weight: 700; font-size: 1.2rem;}

.chat-body {flex: 1; padding: 1rem; display: flex; flex-direction: column; gap: 10px; overflow-y: auto; background: #e8f0fe; min-height: 300px;}

.message {max-width: 80%; padding: 0.8rem 1rem; border-radius: 15px; box-shadow: var(--shadow); opacity: 0; transform: translateY(20px); animation: fadeInUp 0.3s forwards; word-wrap: break-word;}

.user-msg {background: var(--user-bg); align-self: flex-end;}
.ai-msg {background: var(--ai-bg); align-self: flex-start;}

@keyframes fadeInUp {to {opacity: 1; transform: translateY(0);}}

.chat-input {display: flex; padding: 0.5rem; background: #fff; gap: 0.5rem;}
.chat-input textarea {flex: 1; border-radius: 10px; border: 1px solid #cbd5e1; padding: 0.8rem; font-size: 1rem; resize: none;}
.chat-input button {background: var(--primary-color); border: none; color: #fff; padding: 0 1rem; border-radius: 10px; font-weight: 700; cursor: pointer; transition: background 0.2s;}
.chat-input button:hover {background: var(--primary-dark);}

.loading-inline {display: inline-block;width: 100%;text-align: center;}
.loading-inline span {display: inline-block;width: 8px;height: 8px;margin: 0 2px;background: var(--primary-color);border-radius: 50%;animation: bounce 0.6s infinite alternate;}
.loading-inline span:nth-child(2){animation-delay:0.2s;}
.loading-inline span:nth-child(3){animation-delay:0.4s;}
@keyframes bounce {to {transform: translateY(-8px);}}

.settings {background: #fff; border-radius: 10px; padding: 1rem; margin-bottom: 1rem; box-shadow: var(--shadow);}
.settings h3 {margin-bottom: 0.5rem;}
.settings label {display: block;margin:0.3rem 0;font-weight:700;}
.settings input, .settings select, .settings textarea {width: 100%; padding:0.5rem; border-radius:8px; border:1px solid #cbd5e1; margin-bottom:0.5rem;}
.save-memory-btn {background: #16a34a;color:#fff;padding:0.5rem 1rem;border:none;border-radius:8px;cursor:pointer;margin-top:0.5rem;}
.save-memory-btn:hover {background:#15803d;}
.memory-list {background:#f1f5f9;padding:0.5rem;border-radius:8px; max-height:100px; overflow-y:auto;}
.memory-list p{margin:0.2rem 0;padding:0.2rem 0.5rem;background:#e0f2fe;border-radius:5px;}

.scenario-container {position: relative; margin-bottom: 1rem;}
.scenario-dropdown {width: 100%; border-radius:8px; border:1px solid #cbd5e1; padding:0.5rem; cursor:pointer; background:#fff;}
.scenario-list {position: absolute; top:42px; width: 100%; max-height:200px; overflow-y:auto; background:#fff; border:1px solid #cbd5e1; border-radius:8px; display:none; z-index:100;}
.scenario-list p {padding:0.5rem; margin:0; cursor:pointer;}
.scenario-list p:hover {background:#e0f2fe;}
.scenario-search {width: calc(100% - 1rem); padding:0.3rem 0.5rem; margin:0.5rem; border:1px solid #cbd5e1; border-radius:5px;}
</style>
</head>
<body>

<div class="chat-container">

    <div class="settings">
        <h3>ØªÙ†Ø¸ÛŒÙ…Ø§Øª AI</h3>
        <label>Ø§Ø³Ù… AI:</label>
        <input type="text" id="ai-name" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø³Ø§Ø±Ø§">
        <label>Ø´Ø®ØµÛŒØª AI:</label>
        <textarea id="ai-personality" placeholder="Ù…Ø«Ù„Ø§Ù‹: ØµÙ…ÛŒÙ…ÛŒØŒ Ø´ÙˆØ®ØŒ Ø¨Ø§Ù‡ÙˆØ´ Ùˆ Ú©Ù…Ú©â€ŒÚ©Ù†Ù†Ø¯Ù‡"></textarea>
        <label>Ù…Ø¯Ù„:</label>
        <select id="model-select">
            <option value="gemini-1.5-flash">Gemini 1.5</option>
            <option value="gemini-2.5-flash">Gemini 2.5</option>
        </select>

        <label>Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ù†Ø§Ø±ÛŒÙˆ (Ø§Ø®ØªÛŒØ§Ø±ÛŒ):</label>
        <div class="scenario-container">
            <input type="text" id="scenario-search" class="scenario-search" placeholder="Ø¬Ø³ØªØ¬Ùˆ ÛŒØ§ Ø³Ø§Ø®Øª Ø³Ù†Ø§Ø±ÛŒÙˆ Ø¬Ø¯ÛŒØ¯...">
            <div id="scenario-dropdown" class="scenario-dropdown">Ø§Ù†ØªØ®Ø§Ø¨ Ø³Ù†Ø§Ø±ÛŒÙˆ</div>
            <div id="scenario-list" class="scenario-list"></div>
        </div>

        <label>Ø³Ù†Ø§Ø±ÛŒÙˆ ÙØ¹Ù„ÛŒ:</label>
        <textarea id="chat-scenario" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ù…Ø§ Ø¯Ø± ÛŒÚ© Ù…Ø§Ø¬Ø±Ø§Ø¬ÙˆÛŒÛŒ Ø¬Ø§Ø¯ÙˆÛŒÛŒ Ù‡Ø³ØªÛŒÙ…..."></textarea>

        <button class="save-memory-btn" id="save-memory-btn">Ù†Ù…Ø§ÛŒØ´ Save Memory</button>
        <div class="memory-list" id="memory-list"></div>
    </div>

    <div class="chat-body" id="chat-body"></div>

    <div class="chat-input">
        <textarea id="user-input" placeholder="Ù¾ÛŒØ§Ù… Ø®ÙˆØ¯ Ø±Ø§ Ø¨Ù†ÙˆÛŒØ³ÛŒØ¯..." rows="1"></textarea>
        <button id="send-btn">Ø§Ø±Ø³Ø§Ù„</button>
    </div>
</div>

<script>
// Ú©Ù„ÛŒØ¯ API Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ø§Ù…Ù†ÛŒØª Ø¨ÛŒØ´ØªØ± Ø§Ø² Ø§ÛŒÙ†Ø¬Ø§ Ø­Ø°Ù Ú©Ø±Ø¯Ù…. Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ÛŒØ¯ Ú©Ù„ÛŒØ¯ Ø®ÙˆØ¯ Ø±Ø§ Ø¬Ø§ÛŒÚ¯Ø²ÛŒÙ† Ú©Ù†Ø¯.
const API_KEY = "YOUR_API_KEY_HERE"; 

const chatBody = document.getElementById('chat-body');
const userInput = document.getElementById('user-input');
const sendBtn = document.getElementById('send-btn');
const modelSelect = document.getElementById('model-select');
const aiNameInput = document.getElementById('ai-name');
const aiPersonalityInput = document.getElementById('ai-personality');
const chatScenarioInput = document.getElementById('chat-scenario');
const saveMemoryBtn = document.getElementById('save-memory-btn');
const memoryListDiv = document.getElementById('memory-list');

const scenarioDropdown = document.getElementById('scenario-dropdown');
const scenarioListDiv = document.getElementById('scenario-list');
const scenarioSearch = document.getElementById('scenario-search');

const scenarios = [
    { name: "Ø¯Ú©ØªØ± Ù…ØªØ®ØµØµ", character: "Ù…Ù‡Ø±Ø¨Ø§Ù† Ùˆ Ø¯Ù‚ÛŒÙ‚", text: "ÛŒÚ© Ù¾Ø²Ø´Ú© Ù…ØªØ®ØµØµ Ú©Ù‡ Ø¬Ø§Ù† Ø¨ÛŒÙ…Ø§Ø±Ø§Ù† Ø¨Ø±Ø§ÛŒØ´ Ù…Ù‡Ù… Ø§Ø³Øª." },
    { name: "Ù‡Ú©Ø±", character: "Ø¨Ø§Ù‡ÙˆØ´ Ùˆ Ù…Ø±Ù…ÙˆØ²", text: "ÛŒÚ© Ù‡Ú©Ø± Ú©Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ø¯ Ù‡Ø± Ø³ÛŒØ³ØªÙ…ÛŒ Ø±Ø§ Ù†ÙÙˆØ° Ú©Ù†Ø¯." },
    { name: "Ú©Ø§Ø±Ø¢Ú¯Ø§Ù‡", character: "ØªÛŒØ²Ø¨ÛŒÙ† Ùˆ Ø¬Ø¯ÛŒ", text: "Ø­Ù„ Ù¾Ø±ÙˆÙ†Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù¾ÛŒÚ†ÛŒØ¯Ù‡ Ø¬Ù†Ø§ÛŒÛŒ." },
    { name: "Ø¢Ø´Ù¾Ø² Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ", character: "Ø®Ù„Ø§Ù‚ Ùˆ Ø®ÙˆØ´â€ŒØ¨Ø±Ø®ÙˆØ±Ø¯", text: "Ù¾Ø®Øª Ø¨Ù‡ØªØ±ÛŒÙ† ØºØ°Ø§Ù‡Ø§ÛŒ Ø¬Ù‡Ø§Ù†." },
    { name: "Ù¾Ú˜ÙˆÙ‡Ø´Ú¯Ø± ÙØ¶Ø§ÛŒÛŒ", character: "Ú©Ù†Ø¬Ú©Ø§Ùˆ Ùˆ Ø´Ø¬Ø§Ø¹", text: "Ú©Ø§ÙˆØ´ Ø¯Ø± Ø³ÛŒØ§Ø±Ø§Øª Ù†Ø§Ø´Ù†Ø§Ø®ØªÙ‡." }
];

let chatHistory = [];
let saveMemory = [];
let scenarioLoading = false;

function addMessage(text,className){
    const msgDiv=document.createElement('div');
    msgDiv.classList.add('message',className);
    msgDiv.innerHTML=text;
    chatBody.appendChild(msgDiv);
    chatBody.scrollTop=chatBody.scrollHeight;
}

function addLoading(){
    const loadingDiv=document.createElement('div');
    loadingDiv.classList.add('message','ai-msg');
    loadingDiv.innerHTML=`<div class="loading-inline"><span></span><span></span><span></span></div>`;
    chatBody.appendChild(loadingDiv);
    chatBody.scrollTop=chatBody.scrollHeight;
    return loadingDiv;
}

function updateMemoryList(){
    memoryListDiv.innerHTML='';
    saveMemory.forEach((m)=>{
        const p=document.createElement('p');
        p.textContent=m;
        memoryListDiv.appendChild(p);
    });
}

function showScenarioList(filter=''){
    scenarioListDiv.innerHTML='';
    scenarioLoading = true;

    const loadingP = document.createElement('p');
    loadingP.innerHTML = '<div class="loading-inline"><span></span><span></span><span></span></div>';
    scenarioListDiv.appendChild(loadingP);
    scenarioListDiv.style.display = 'block';

    setTimeout(async()=>{
        scenarioListDiv.innerHTML='';
        let filtered = scenarios.filter(s=>s.name.includes(filter));
        if(filtered.length === 0){
            const li = document.createElement('p');
            li.style.fontStyle='italic';
            li.textContent = 'Ø³Ø§Ø®Øª Ø³Ù†Ø§Ø±ÛŒÙˆ Ø¬Ø¯ÛŒØ¯';
            li.onclick = async ()=>{
                scenarioListDiv.innerHTML = '<p style="text-align:center"><div class="loading-inline"><span></span><span></span><span></span></div></p>';
                const prompt = `ÛŒÚ© Ø³Ù†Ø§Ø±ÛŒÙˆ Ú©ÙˆØªØ§Ù‡ Ùˆ Ø¬Ø°Ø§Ø¨ ÙØ§Ø±Ø³ÛŒ Ø¨Ø³Ø§Ø² Ùˆ Ø§Ø³Ù…ØŒ Ø´Ø®ØµÛŒØª Ùˆ Ù…ØªÙ† Ø±Ø§ Ø¬Ø¯Ø§ Ú©Ù† Ø¨Ù‡ ØµÙˆØ±Øª JSON Ø¨Ø§ Ú©Ù„ÛŒØ¯Ù‡Ø§ÛŒ name, character, text`;
                const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${modelSelect.value}:generateContent?key=${API_KEY}`;
                try{
                    const response = await fetch(API_URL,{
                        method:'POST',
                        headers:{'Content-Type':'application/json'},
                        body:JSON.stringify({contents:[{parts:[{text:prompt}]}]})
                    });
                    const data = await response.json();
                    const resultText = data.candidates[0].content.parts[0].text.trim();
                    let newScenario;
                    try{ newScenario = JSON.parse(resultText); }catch(e){ newScenario = {name:'Ø³Ù†Ø§Ø±ÛŒÙˆ Ø¬Ø¯ÛŒØ¯', character:'Ø®ÙˆØ¯Ú©Ø§Ø±', text:resultText}; }
                    scenarioDropdown.textContent = newScenario.name;
                    aiNameInput.value = newScenario.name;
                    aiPersonalityInput.value = newScenario.character;
                    chatScenarioInput.value = newScenario.text;
                    scenarios.push(newScenario);
                    scenarioListDiv.style.display = 'none';
                    scenarioLoading = false;
                }catch(e){
                    alert('Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø¢Ù…Ø¯ ÛŒØ§ Ú©Ù„ÛŒØ¯ API Ù†Ø§Ù…Ø¹ØªØ¨Ø± Ø§Ø³Øª ğŸ˜…');
                    scenarioLoading = false;
                }
            };
            scenarioListDiv.appendChild(li);
        } else {
            filtered.forEach(s => {
                const li = document.createElement('p');
                li.textContent = s.name;
                li.onclick = () => {
                    scenarioDropdown.textContent = s.name;
                    aiNameInput.value = s.name;
                    aiPersonalityInput.value = s.character;
                    chatScenarioInput.value = s.text;
                    scenarioListDiv.style.display = 'none';
                    scenarioLoading = false;
                };
                scenarioListDiv.appendChild(li);
            });
        }
        scenarioLoading = false;
    }, 700);
}

scenarioDropdown.addEventListener('click', ()=>{ showScenarioList(scenarioSearch.value); });
scenarioSearch.addEventListener('input', ()=>{ showScenarioList(scenarioSearch.value); });

async function sendMessage(){
    if(API_KEY === "YOUR_API_KEY_HERE") {
        alert("Ù„Ø·ÙØ§Ù‹ Ø§Ø¨ØªØ¯Ø§ Ú©Ù„ÛŒØ¯ API Ø®ÙˆØ¯ Ø±Ø§ Ø¯Ø± Ø³ÙˆØ±Ø³ Ú©Ø¯ Ù‚Ø±Ø§Ø± Ø¯Ù‡ÛŒØ¯.");
        return;
    }
    const text = userInput.value.trim();
    if(!text) return;
    addMessage(text,'user-msg');
    userInput.value = '';

    chatHistory.push({role:'user', content:text});
    const loadingDiv = addLoading();

    const aiName = aiNameInput.value || 'AI';
    const aiPersonality = aiPersonalityInput.value || 'ØµÙ…ÛŒÙ…ÛŒ Ùˆ Ø¯ÙˆØ³ØªØ§Ù†Ù‡';
    const chatScenario = chatScenarioInput.value || '';

    if(/ÛŒØ§Ø¯Øª Ø¨Ø§Ø´Ù‡|Ø­ÙØ¸ Ú©Ù†|Ø¨Ù‡ ÛŒØ§Ø¯ Ø¨Ø³Ù¾Ø§Ø±/i.test(text)){
        saveMemory.push(text.replace(/ÛŒØ§Ø¯Øª Ø¨Ø§Ø´Ù‡|Ø­ÙØ¸ Ú©Ù†|Ø¨Ù‡ ÛŒØ§Ø¯ Ø¨Ø³Ù¾Ø§Ø±/i,'').trim());
        updateMemoryList();
    }

    let promptText = `ØªÙˆ ÛŒÚ© Ø¯Ø³ØªÛŒØ§Ø± ${aiPersonality} Ù‡Ø³ØªÛŒ Ø¨Ù‡ Ø§Ø³Ù… ${aiName}. 
ØªÙˆ Ù¾ÛŒØ§Ù…â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ Ø±Ø§ Ø¨Ù‡ ÛŒØ§Ø¯ Ø¯Ø§Ø±ÛŒ Ùˆ Ù‡Ù…Ú†Ù†ÛŒÙ† Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¯Ø§Ø®Ù„ Save Memory: ${saveMemory.join('; ')}.
${chatScenario ? 'Ø³Ù†Ø§Ø±ÛŒÙˆ ÙØ¹Ù„ÛŒ: '+chatScenario : ''}
Ø¨Ø§ Ú©Ø§Ø±Ø¨Ø± Ù…Ø«Ù„ Ø¯ÙˆØ³Øª ÙˆØ§Ù‚Ø¹ÛŒ ØµØ­Ø¨Øª Ú©Ù† Ùˆ Ø±Ø³Ù…ÛŒ Ù†Ø¨Ø§Ø´.\n\n`;

    chatHistory.forEach(msg=>{
        promptText += `${msg.role==='user' ? 'Ú©Ø§Ø±Ø¨Ø±' : 'AI'} Ú¯ÙØªÙ‡: ${msg.content}\n`;
    });

    const selectedModel = modelSelect.value;
    const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/${selectedModel}:generateContent?key=${API_KEY}`;

    try{
        const response = await fetch(API_URL,{
            method:'POST',
            headers:{'Content-Type':'application/json'},
            body:JSON.stringify({contents:[{parts:[{text:promptText}]}]})
        });
        const data = await response.json();
        const aiText = data.candidates[0].content.parts[0].text;

        loadingDiv.remove();
        addMessage(aiText,'ai-msg');
        chatHistory.push({role:'AI', content:aiText});

    }catch(e){
        loadingDiv.remove();
        addMessage('Ø§ÙˆÙˆÙˆÙˆÙ‡ØŒ Ù…Ø´Ú©Ù„ÛŒ Ù¾ÛŒØ´ Ø§ÙˆÙ…Ø¯ ğŸ˜…','ai-msg');
    }
}

sendBtn.addEventListener('click', sendMessage);
userInput.addEventListener('keypress', e=>{
    if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); sendMessage(); }
});

saveMemoryBtn.addEventListener('click', updateMemoryList);

document.addEventListener('click', e=>{
    if(!scenarioDropdown.contains(e.target) && !scenarioListDiv.contains(e.target) && !scenarioSearch.contains(e.target)){
        scenarioListDiv.style.display='none';
    }
});
</script>

</body>
</html>
